<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>ArcGIS Maps SDK for JavaScript Tutorials: Display a map</title>

    <style>
    html, body, #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
      #types-filter {
        height: 160px;
        width: 100%;
        visibility: hidden;
      }

      .type-item {
        width: 100%;
        padding: 12px;
        text-align: center;
        vertical-align: baseline;
        cursor: pointer;
        height: 40px;
      }

      .type-item:focus {
        background-color: dimgrey;
      }

      .type-item:hover {
        background-color: dimgrey;
      }

      #titleDiv {
        padding: 10px;
      }

      #titleText {
        font-size: 20pt;
        font-weight: 60;
        padding-bottom: 10px;
      }

     #legendPane {
      border: solid #97DCF2 1px;
    }
    </style>

    <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.25/"></script>

    <script>
require([
  "esri/WebMap",
  "esri/views/MapView",
  "esri/widgets/Legend",
  "esri/widgets/ScaleBar",
  "esri/widgets/CoordinateConversion",
  "esri/layers/GraphicsLayer",
   "esri/layers/FeatureLayer",
  "esri/layers/GroupLayer",
  "esri/widgets/Sketch",
  "esri/widgets/Locate",
  "esri/widgets/Track",
  "esri/Graphic",
  "esri/widgets/LayerList",
  "esri/widgets/Expand",
  "esri/widgets/Directions",
], function(WebMap, MapView, Legend, ScaleBar, CoordinateConversion, GraphicsLayer, FeatureLayer, GroupLayer, Sketch, Locate, Track, Graphic, LayerList, Expand, Directions) {
  let floodLayerView;


      const popupAmsterdamLocations = {
          "title": "Amsterdam photo spot",
          "content": "<b>Spot:</b> {NAME}<br><b>Address:</b> {ADDRESS}<br><b>Type:</b> {TYPE}<br>"
        }


        const layerOutdoor = new FeatureLayer({
            url: "https://services7.arcgis.com/MJ49ITIfNNDoBpyy/arcgis/rest/services/amsteramlocationsoutdoor/FeatureServer/0",
            outFields: ["NAME","ADDRESS","TYPE"],
            popupTemplate: popupAmsterdamLocations,
    visible: false,

        });

      const layerIndoor = new FeatureLayer({
          url: "https://services7.arcgis.com/MJ49ITIfNNDoBpyy/arcgis/rest/services/amsteramlocationsindoor/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
    visible: false,

      });

      const layer = new FeatureLayer({
          url: "https://services7.arcgis.com/MJ49ITIfNNDoBpyy/arcgis/rest/services/amsterdamlocations/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations
      });

      const layerIndoorNight = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_indoor_night/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

      const layerOutdoorNight = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_outdoor_night/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

      const layerNight = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_night/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

      const layerIndoorNoon = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_noon_indoor/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

      const layerOutdoorNoon = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_outdoor_noon/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

      const layerNoon = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_noon/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

      const layerMorning = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_morning/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

      const layerIndoorMorning = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_morning_indoor/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

      const layerOutdoorMorning = new FeatureLayer({
          url: "https://services.arcgis.com/GITr6UCV3bhY1az9/arcgis/rest/services/amsterdam_locations_morning_outdoor/FeatureServer/0",
          outFields: ["NAME","ADDRESS","TYPE"],
          popupTemplate: popupAmsterdamLocations,
          visible: false,
      });

   var typeGroupLayer = new GroupLayer({
    title: "Attractions by type (indoor, outdoor, both)",
    visible: true,
    visibilityMode: "exclusive",
    layers: [layerOutdoor, layerIndoor, layer, layerIndoorNight, layerOutdoorNight, layerNight, layerIndoorNoon, layerOutdoorNoon, layerNoon, layerIndoorMorning, layerOutdoorMorning, layerMorning],
    opacity: 0.75
  });

  var webmap = new WebMap({

    layers: [typeGroupLayer],
    basemap: "streets-navigation-vector"
  });

  var view = new MapView({
    container: "viewDiv",
    map: webmap,
    center: [4.907144, 52.3754],
    zoom: 13
  });


  function defineActions(event) {
    // The event object contains an item property.
    // is is a ListItem referencing the associated layer
    // and other properties. You can control the visibility of the
    // item, its title, and actions using this object.

    var item = event.item;

    if (item.title === "Attractions by time of the day") {
      // An array of objects defining actions to place in the LayerList.
      // By making this array two-dimensional, you can separate similar
      // actions into separate groups with a breaking line.

      item.actionsSections = [
        [
          {
            title: "Go to full extent",
            className: "esri-icon-zoom-out-fixed",
            id: "full-extent"
          },
          {
            title: "Layer information",
            className: "esri-icon-description",
            id: "information"
          }
        ],
        [
          {
            title: "Increase opacity",
            className: "esri-icon-up",
            id: "increase-opacity"
          },
          {
            title: "Decrease opacity",
            className: "esri-icon-down",
            id: "decrease-opacity"
          }
        ]
      ];
    }
  }

  view.when(function () {
    // Create the LayerList widget with the associated actions
    // and add it to the top-right corner of the view.

    var layerList = new LayerList({
      view: view,
      // executes for each ListItem in the LayerList
      listItemCreatedFunction: defineActions
    });

    // Event listener that fires each time an action is triggered

    layerList.on("trigger-action", function (event) {
      // The layer visible in the view at the time of the trigger.
      var visibleLayer
      // = morningLayer.visible ? morningLayer : eveningLayer;
if (layer.visible) {
          visibleLayer = layer
      } else if (layerIndoor.visible) {
      visibleLayer = layerIndoor
      } else if(layerOutdoor.visible) {
      visibleLayer = layerOutdoor
      } else if(layerIndoorNight.visible) {
        visibleLayer = layerIndoorNight
      } else if(layerOutdoorNight.visible) {
        visibleLayer = layerOutdoorNight
      } else if (layerNight.visible) {
        visibleLayer = layerNight
      } else if (layerIndoorNoon.visible) {
        visibleLayer = layerIndoorNoon
      } else if (layerOutdoorNoon.visible) {
        visibleLayer = layerOutdoorNoon
      } else if (layerNoon.visible) {
        visibleLayer = layerNoon
      } else if (layerIndoorMorning.visible) {
        visibleLayer = layerIndoorMorning
      } else if (layerOutdoorMorning.visible) {
        visibleLayer = layerOutdoorMorning
      } else if (layerMorning.visible) {
        visibleLayer = layerMorning
      }
      // Capture the action id.
      var id = event.action.id;

      if (id === "full-extent") {
        // if the full-extent action is triggered then navigate
        // to the full extent of the visible layer

        view.goTo(visibleLayer.fullExtent).catch(function (error) {
          if (error.name != "AbortError") {
            console.error(error);
          }
        });
      } else if (id === "information") {
        // if the information action is triggered, then
        // open the item details page of the service layer
        window.open(visibleLayer.url);
      } else if (id === "increase-opacity") {
        // if the increase-opacity action is triggered, then
        // increase the opacity of the GroupLayer by 0.25

        if (typeGroupLayer.opacity < 1) {
          typeGroupLayer.opacity += 0.25;
        }
      } else if (id === "decrease-opacity") {
        // if the decrease-opacity action is triggered, then
        // decrease the opacity of the GroupLayer by 0.25

        if (typeGroupLayer.opacity > 0) {
          typeGroupLayer.opacity -= 0.25;
        }
      }
    });

    // Add widget to the top right corner of the view
    view.ui.add(layerList, "top-right");
    const legend = new Expand({
    content: new Legend({
      view: view,
      style: "classic" // other styles include 'classic'
    }),
    view: view,
    expanded: true
  });


view.ui.add(legend, "top-left");
typeGroupLayer.layers.every(function(element){
  var seasonsNodes = document.querySelectorAll(`.type-item`);
var  seasonsElement = document.getElementById("types-filter");

  // click event handler for seasons choices
  seasonsElement.addEventListener("click", filterBySeason);

  // User clicked on Winter, Spring, Summer or Fall
  // set an attribute filter on flood warnings layer view
  // to display the warnings issued in that season

  function filterBySeason(event) {
    var selectedSeason = event.target.getAttribute("data-type");
    floodLayerView.filter = {
      where: "Type = '" + selectedSeason + "'"
    };
  }

  view.whenLayerView(element).then(function (layerView) {
    floodLayerView = layerView;
    seasonsElement.style.visibility = "visible";
    var seasonsExpand = new Expand({
      view: view,
      content: seasonsElement,
      expandIconClass: "esri-icon-filter",
      group: "top-left"
    });
    seasonsExpand.watch("expanded", function () {
      if (!seasonsExpand.expanded) {
        floodLayerView.filter = null;
      }
    });

    view.ui.add(seasonsExpand, "top-left");




  });
});

view.ui.add("titleDiv", "bottom-left");

           var directionsWidget = new Directions({
    view: view,
    // Point the URL to a valid route service that uses an
    // ArcGIS Online hosted service proxy instead of the default service
    routeServiceUrl:
"https://utility.arcgis.com/usrsvcs/appservices/kv85zENFGmJpK3YU/rest/services/World/Route/NAServer/Route_World"


  });
    view.ui.add(directionsWidget, {
    position: "top-right"
  });
});
});
    </script>

  </head>
  <body>
    <div id="types-filter" class="esri-widget"> 
      <!--  todo make these filters work -->
      <div class="type-item visible-item" data-type="Morning">Morning</div>
      <div class="type-item visible-item" data-type="Noon">Noon</div>
      <div class="type-item visible-item" data-type="Night">Night</div>
    </div> 
    <div id="viewDiv"></div>
    <div id="titleDiv" class="esri-widget">
      <div id="titleText">Amsterdam locations</div>
      <div>Amsterdam 2023</div>
    </div>
  </body>
</html>

<!--  todo add login / register page with firebase -->